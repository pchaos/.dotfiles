#!/usr/bin/env zsh
# Last Modified: 2025-06-12 12:19:41

# stow (GNU Stow) version 2.3.1

# SYNOPSIS:

#     stow [OPTION ...] [-D|-S|-R] PACKAGE ... [-D|-S|-R] PACKAGE ...

# OPTIONS:

#     -d DIR, --dir=DIR     Set stow dir to DIR (default is current dir)
#     -t DIR, --target=DIR  Set target to DIR (default is parent of stow dir)

#     -S, --stow            Stow the package names that follow this option
#     -D, --delete          Unstow the package names that follow this option
#     -R, --restow          Restow (like stow -D followed by stow -S)

#     --ignore=REGEX        Ignore files ending in this Perl regex
#     --defer=REGEX         Don't stow files beginning with this Perl regex
#                           if the file is already stowed to another package
#     --override=REGEX      Force stowing files beginning with this Perl regex
#                           if the file is already stowed to another package
#     --adopt               (Use with care!)  Import existing files into stow package
#                           from target.  Please read docs before using.
#     -p, --compat          Use legacy algorithm for unstowing

#     -n, --no, --simulate  Do not actually make any filesystem changes
#     -v, --verbose[=N]     Increase verbosity (levels are from 0 to 5;
#                             -v or --verbose adds 1; --verbose=N sets level)
#     -V, --version         Show stow version number
#     -h, --help            Show this help

# Report bugs to: bug-stow@gnu.org
# Stow home page: <http://www.gnu.org/software/stow/>
# General help using GNU software: <http://www.gnu.org/gethelp/>

echo "Stowing Dotfiles...";

if [[ -z $STOW_FOLDERS ]]; then
  # STOW_FOLDERS="bash,conda,git,htinsight,lvim,tmux"
  STOW_FOLDERS="bash,conda,git,lvim,tmux"
fi

if [[ -z $DOTFILES ]]; then
  DOTFILES=$HOME/.dotfiles
fi
echo $STOW_FOLDERS $DOTFILES

# è°ƒç”¨åŒç›®å½•ä¸‹çš„ï¼šinstall
STOW_FOLDERS=$STOW_FOLDERS DOTFILES=$DOTFILES $DOTFILES/install

# æ£€æŸ¥powerlevel10kä¸»é¢˜
THEME_DIR="${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k"

# æ£€æŸ¥ä¸»é¢˜ç›®å½•æ˜¯å¦å­˜åœ¨
if [ ! -d "$THEME_DIR" ]; then
  echo "â³ æ­£åœ¨å…‹éš†powerlevel10kä¸»é¢˜..."
  git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k

  # éªŒè¯å…‹éš†ç»“æœ
  if [ $? -eq 0 ]; then
    echo "âœ… ä¸»é¢˜å®‰è£…æˆåŠŸï¼"
    ls -la "$THEME_DIR" | head -5  # æ˜¾ç¤ºå‰5ä¸ªæ–‡ä»¶éªŒè¯
  else
    echo "âŒ å…‹éš†å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œgité…ç½®"
    exit 1
  fi
else
  echo "â„¹ï¸ ä¸»é¢˜å·²å­˜åœ¨ï¼Œç›®å½•å†…å®¹ï¼š"
  ls -la "$THEME_DIR" | head -5
fi

# æ£€æŸ¥å…³é”®æ–‡ä»¶
THEME_FILE="$THEME_DIR/powerlevel10k.zsh-theme"
[ -f "$THEME_FILE" ] && echo "ğŸ” æ‰¾åˆ°ä¸»é¢˜æ–‡ä»¶: $THEME_FILE" || echo "âš ï¸ ç¼ºå°‘ä¸»é¢˜æ–‡ä»¶"
